<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.findu.negotiation.infrastructure.mapper.CalendarMapper">

    <!-- Result Map -->
    <resultMap id="CalendarResultMap" type="com.findu.negotiation.domain.calendar.entity.CalendarEntity">
        <id property="id" column="id"/>
        <result property="calendarId" column="calendar_id"/>
        <result property="providerId" column="provider_id"/>
        <result property="name" column="name"/>
        <result property="description" column="description"/>
        <result property="timezone" column="timezone"/>
        <result property="status" column="status"/>
        <result property="gmtCreate" column="gmt_create"/>
        <result property="gmtModify" column="gmt_modify"/>
    </resultMap>

    <!-- Base Columns -->
    <sql id="Base_Column_List">
        id, calendar_id, provider_id, name, description, timezone, status, gmt_create, gmt_modify
    </sql>

    <!-- Insert Calendar -->
    <insert id="insert" parameterType="com.findu.negotiation.domain.calendar.entity.CalendarEntity" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO calendar (
            calendar_id, provider_id, name, description, timezone, status, gmt_create, gmt_modify
        ) VALUES (
            #{calendarId}, #{providerId}, #{name}, #{description}, #{timezone}, #{status}, NOW(), NOW()
        )
    </insert>

    <!-- Insert Selective (only insert non-null fields) -->
    <insert id="insertSelective" parameterType="com.findu.negotiation.domain.calendar.entity.CalendarEntity" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO calendar
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="calendarId != null">calendar_id,</if>
            <if test="providerId != null">provider_id,</if>
            <if test="name != null">name,</if>
            <if test="description != null">description,</if>
            <if test="timezone != null">timezone,</if>
            <if test="status != null">status,</if>
            gmt_create, gmt_modify
        </trim>
        <trim prefix="VALUES (" suffix=")" suffixOverrides=",">
            <if test="calendarId != null">#{calendarId},</if>
            <if test="providerId != null">#{providerId},</if>
            <if test="name != null">#{name},</if>
            <if test="description != null">#{description},</if>
            <if test="timezone != null">#{timezone},</if>
            <if test="status != null">#{status},</if>
            NOW(), NOW()
        </trim>
    </insert>

    <!-- Update Calendar -->
    <update id="update" parameterType="com.findu.negotiation.domain.calendar.entity.CalendarEntity">
        UPDATE calendar
        <set>
            <if test="name != null">name = #{name},</if>
            <if test="description != null">description = #{description},</if>
            <if test="timezone != null">timezone = #{timezone},</if>
            <if test="status != null">status = #{status},</if>
            gmt_modify = NOW()
        </set>
        WHERE calendar_id = #{calendarId}
    </update>

    <!-- Insert Batch -->
    <insert id="insertBatch" parameterType="java.util.List">
        INSERT INTO calendar (
            calendar_id, provider_id, name, description, timezone, status, gmt_create, gmt_modify
        ) VALUES
        <foreach collection="list" item="item" separator=",">
        (#{item.calendarId}, #{item.providerId}, #{item.name}, #{item.description}, #{item.timezone}, #{item.status}, NOW(), NOW())
        </foreach>
    </insert>

    <!-- Find By Id -->
    <select id="findById" parameterType="string" resultMap="CalendarResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM calendar
        WHERE calendar_id = #{calendarId}
    </select>

    <!-- Find By Provider Id -->
    <select id="findByProviderId" parameterType="string" resultMap="CalendarResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM calendar
        WHERE provider_id = #{providerId}
        ORDER BY gmt_create DESC
    </select>

    <!-- Find By Provider Id And Status -->
    <select id="findByProviderIdAndStatus" resultMap="CalendarResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM calendar
        WHERE provider_id = #{providerId}
          AND status = #{status}
        ORDER BY gmt_create DESC
    </select>

    <!-- Delete By Id -->
    <delete id="deleteById" parameterType="string">
        DELETE FROM calendar
        WHERE calendar_id = #{calendarId}
    </delete>

    <!-- Exists By Id -->
    <select id="existsById" parameterType="string" resultType="boolean">
        SELECT COUNT(1) > 0
        FROM calendar
        WHERE calendar_id = #{calendarId}
    </select>

    <!-- Exists By Calendar Id And Provider Id -->
    <select id="existsByCalendarIdAndProviderId" resultType="boolean">
        SELECT COUNT(1) > 0
        FROM calendar
        WHERE calendar_id = #{calendarId}
          AND provider_id = #{providerId}
    </select>

</mapper>
